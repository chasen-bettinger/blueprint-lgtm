// Generated by CoffeeScript 1.6.3
(function() {
  var Pool, Q, SqlCore, mysql;

  mysql = require('mysql');

  Pool = require('generic-pool').Pool;

  Q = require('q');

  SqlCore = (function() {
    function SqlCore(config, log) {
      this.pool = Pool({
        name: 'mysql - Blueprint',
        create: function(cb) {
          var conn;
          conn = mysql.createConnection(config);
          return cb(null, conn);
        },
        destroy: function(conn) {
          return conn.end();
        },
        max: config.maxConnections,
        min: config.minConnections,
        idleTimeoutMillis: config.idleTimeoutMillis,
        log: false
      });
      this.acquire = function(callback) {
        return this.pool.acquire(callback);
      };
      this.Acquire = Q.nbind(this.acquire, this);
      this.release = function(conn) {
        return this.pool.release(conn);
      };
      this.destroy = function(conn) {
        return this.pool.destroy(conn);
      };
      this.sqlQuery = function(conn, sql, args) {
        log.debug('sqlQuery:', sql, args);
        return (Q.ninvoke(conn, 'query', sql, args)).then(function(rows_n_cols) {
          return rows_n_cols[0];
        });
      };
    }

    return SqlCore;

  })();

  exports.SqlCore = SqlCore;

}).call(this);
