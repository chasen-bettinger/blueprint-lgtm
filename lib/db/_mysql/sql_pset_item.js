// Generated by CoffeeScript 1.6.3
(function() {
  var E, Q, SqlPSetItem;

  Q = require('q');

  E = require('../../error');

  SqlPSetItem = (function() {
    function SqlPSetItem(db, log) {
      this.db = db;
      this.log = log;
      this.table = 'pset_item';
      this.schema = {
        create: ['pset_id', 'xref'],
        get_by_id: ['*'],
        id_xref: ['*'],
        get_psid: ['*']
      };
      this.db.method_factory(this, 'SqlPSetItem');
    }

    SqlPSetItem.prototype.get_psid_xref = function(ctx, pset_id, xref) {
      var f, _log,
        _this = this;
      f = "DB:SqlPSetItem:get_id_xref:";
      _log = ctx.log;
      _log.debug(f, pset_id, xref);
      return Q.resolve().then(function() {
        var sql;
        sql = 'SELECT ' + (_this.schema.id_xref.join(',')) + ' FROM ' + _this.table + ' WHERE pset_id= ? AND xref= ? AND di= 0';
        return _this.db.sqlQuery(ctx, sql, [pset_id, xref]);
      }).then(function(db_rows) {
        return db_rows;
      });
    };

    SqlPSetItem.prototype.get_by_psid = function(ctx, pset_id) {
      var f, _log,
        _this = this;
      f = "DB:SqlPSetItem:get_by_psid:";
      _log = ctx.log;
      _log.debug(f, pset_id);
      return Q.resolve().then(function() {
        var sql;
        sql = 'SELECT ' + (_this.schema.get_psid.join(',')) + ' FROM ' + _this.table + ' WHERE pset_id= ? AND di= 0';
        return _this.db.sqlQuery(ctx, sql, [pset_id]);
      }).then(function(db_rows) {
        return db_rows;
      });
    };

    SqlPSetItem.prototype.delete_pset = function(ctx, pset_id) {
      var f, _log,
        _this = this;
      f = "DB:SqlPSetItem:delete_pset:";
      _log = ctx.log;
      _log.debug(f, pset_id);
      return Q.resolve().then(function() {
        var sql;
        sql = 'DELETE FROM ' + _this.table + ' WHERE pset_id= ?';
        return _this.db.sqlQuery(ctx, sql, [pset_id]);
      }).then(function(db_rows) {
        return db_rows;
      });
    };

    return SqlPSetItem;

  })();

  exports.SqlPSetItem = SqlPSetItem;

}).call(this);
