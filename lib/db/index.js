// Generated by CoffeeScript 1.6.3
(function() {
  var Db;

  Db = (function() {
    function Db(kit) {
      var MCore, SqlCore, config, log, mod, model, mongoose, _i, _j, _len, _len1, _ref, _ref1;
      log = kit.services.logger.log;
      config = kit.services.config;
      if (config.db.mysql.enable) {
        log.info('Initializing MySql...');
        SqlCore = require('./_mysql/sql_core').SqlCore;
        this.mysql = {
          core: new SqlCore(config.db.mysql.pool, log)
        };
        _ref = config.db.mysql.modules;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          mod = _ref[_i];
          if (mod.enable) {
            this.mysql[mod.name] = new (require('./_mysql/' + mod.file))[mod["class"]](this.mysql.core, log);
          }
        }
      }
      if (config.db.mongo.enable) {
        log.info('Initializing MongoDB...');
        MCore = require('./_mongo/model_core').MCore;
        mongoose = require('mongoose');
        mongoose.connect(config.db.mongo.options);
        this.mongo = {
          mcore: new MCore(log)
        };
        _ref1 = config.db.mongo.models;
        for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
          model = _ref1[_j];
          if (model.enable) {
            this.mongo[model.name] = require('./_mongo/models/' + model.file);
          }
        }
      }
    }

    return Db;

  })();

  exports.Db = Db;

}).call(this);
