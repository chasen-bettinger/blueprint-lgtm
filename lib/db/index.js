// Generated by CoffeeScript 1.4.0
var Db;

Db = (function() {

  function Db(kit) {
    var MCore, SqlCore, config, log, mod, model, mongoose, nm, _i, _len, _ref, _ref1;
    log = kit.services.logger.log;
    config = kit.services.config;
    if (config.db.mysql.enable) {
      log.info('Initializing MySql...');
      SqlCore = require('./_mysql/sql_core').SqlCore;
      this.mysql = {
        core: new SqlCore(config.db.mysql.pool, log)
      };
      _ref = config.db.mysql.modules;
      for (nm in _ref) {
        mod = _ref[nm];
        if (mod.enable) {
          this.mysql[nm] = new (require('./_mysql/' + mod.file))[mod["class"]](this.mysql.core, log);
        }
      }
    }
    if (config.db.mongo.enable) {
      log.info('Initializing MongoDB...');
      MCore = require('./_mongo/model_core').MCore;
      mongoose = require('mongoose');
      mongoose.connect(config.db.mongo.options);
      this.mongo = {
        mcore: new MCore(log)
      };
      _ref1 = config.db.mongo.models;
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        model = _ref1[_i];
        if (model.enable) {
          this.mongo[model.name] = require('./_mongo/models/' + model.file);
        }
      }
    }
  }

  return Db;

})();

exports.Db = Db;
