// Generated by CoffeeScript 1.4.0
var Db, path;

path = require('path');

Db = (function() {

  function Db(kit) {
    var MCore, SqlCore, config, log, mod, modPath, model, mongoose, nm, _ref, _ref1;
    log = kit.services.logger.log;
    config = kit.services.config;
    if (config.db.mysql.enable) {
      log.info('Initializing MySql...');
      SqlCore = require('./_mysql/sql_core').SqlCore;
      this.mysql = {
        core: new SqlCore(config.db.mysql.pool, log)
      };
      _ref = config.db.mysql.modules;
      for (nm in _ref) {
        mod = _ref[nm];
        if (!mod.enable) {
          continue;
        }
        modPath = path.join(config.processDir, mod.file);
        this.mysql[nm] = new (require(modPath))[mod["class"]](this.mysql.core, kit);
      }
    }
    if (config.db.mongo.enable) {
      log.info('Initializing MongoDB...');
      MCore = require('./_mongo/model_core').MCore;
      mongoose = require('mongoose');
      mongoose.connect(config.db.mongo.options);
      this.mongo = {
        core: new MCore(log)
      };
      _ref1 = config.db.mongo.models;
      for (nm in _ref1) {
        model = _ref1[nm];
        if (!model.enable) {
          continue;
        }
        modPath = path.join(config.processDir, model.file);
        this.mongo[model.name] = require(modPath);
      }
    }
  }

  return Db;

})();

exports.Db = Db;
