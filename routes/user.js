// Generated by CoffeeScript 1.6.3
(function() {
  var E, Q, User, caller, odb, sdb;

  Q = require('q');

  E = require('../lib/error');

  odb = false;

  sdb = false;

  caller = {
    get: {
      name: 'user_get',
      sql_conn: true,
      auth_required: true,
      load_user: true
    },
    create: {
      name: 'user_create',
      sql_conn: true,
      auth_required: true
    }
  };

  User = (function() {
    function User(db, wrapper, log) {
      log.info('Initializing User Routes...');
      odb = db.mongo;
      sdb = db.mysql;
      this.get = wrapper.read_wrap(caller.get, this._get);
      this.createUser = wrapper.update_wrap(caller.create, this._create);
    }

    User.prototype._get = function(conn, p, pre_loaded, _log) {
      var f;
      f = {
        route: 'user_get'
      };
      _log.debug(f, p);
      return Q.resolve().then(function() {
        return {
          send: {
            success: true,
            user: pre_loaded.user
          }
        };
      });
    };

    User.prototype._create = function(conn, p, pre_loaded, _log) {
      var f;
      f = 'User.createUser:';
      _log.debug(f, p);
      if (!p.email) {
        throw new E.InvalidArg('Invalid Email', {
          param: 'email'
        });
      }
      if (!p.password) {
        throw new E.InvalidArg('Invalid Password', {
          param: 'password'
        });
      }
      return Q.resolve().then(function() {
        return sdb.user.create(conn, p.first_name, p.last_name, p.email, p.password);
      }).then(function(db_result) {
        _log.debug('got create user success:', success);
        return {
          send: {
            success: true
          }
        };
      });
    };

    return User;

  })();

  exports.User = User;

}).call(this);
