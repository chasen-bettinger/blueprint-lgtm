// Generated by CoffeeScript 1.6.3
(function() {
  var Q, User, caller, odb;

  Q = require('q');

  odb = false;

  caller = {
    get: {
      name: 'user_get',
      auth_required: true,
      load_user: true
    },
    create: {
      name: 'user_create',
      auth_required: true
    }
  };

  User = (function() {
    function User(db, wrapper, log) {
      log.info('Initializing User Routes...');
      odb = db;
      this.get = wrapper.read_wrap(caller.get, this._get);
      this.createUser = wrapper.update_wrap(caller.create, this._create);
    }

    User.prototype._get = function(conn, p, pre_loaded, _log) {
      var f;
      f = {
        route: 'user_get'
      };
      _log.debug(f, p);
      return Q.resolve().then(function() {
        return {
          send: pre_loaded.user
        };
      });
    };

    User.prototype._create = function(conn, p, pre_loaded, _log) {
      var f;
      f = 'User.createUser:';
      _log.debug(f, p);
      return Q.resolve().then(function() {
        if (!p.email || !p.password) {
          throw new Error("Missing e-mail or password");
        }
        return odb.user.create(conn, p.first_name, p.last_name, p.email, p.password);
      }).then(function(success) {
        _log.debug('got create user success:', success);
        return {
          send: {
            SUCCESS: true
          }
        };
      });
    };

    return User;

  })();

  exports.User = User;

}).call(this);
